<!DOCTYPE html>
<html>
<!-- Previous head content remains the same until style section -->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Concrete Dreams: A Soccer Story</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400;1,700&family=Source+Sans+Pro:wght@400;700&display=swap" rel="stylesheet">
  
  <style>
    /* Previous styles remain the same */
    body {
      margin: 0;
      font-family: 'Source Sans Pro', sans-serif;
      line-height: 1.6;
      color: #2c3e50;
      background-color: #f8f9fa;
    }

    .intro {
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 0 2rem;
      background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('images/soccer.png');
      background-size: cover;
      background-position: center;
      color: white;
    }

    h1 {
      font-family: 'Lora', serif;
      font-size: 3.5em;
      margin-bottom: 0.5em;
      line-height: 1.2;
    }

    .subtitle {
      font-size: 1.5em;
      font-style: italic;
      max-width: 600px;
      margin-bottom: 2em;
    }

    #scrolly {
      position: relative;
      display: flex;
      background-color: #f8f9fa;
      padding: 1rem;
    }

    article {
      position: relative;
      padding: 0 1rem;
      max-width: 30rem;
      margin: 0 auto;
    }

    .sticky-thing {
      position: sticky;
      width: 100%;
      margin: 0;
      top: 12.5vh;
      height: 75vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    /* New styles for image transition */
    .image-container {
      position: relative;
      width: 90%;
      height: 90%;
      border-radius: 4px;
    }

    .image-container img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 4px;
      opacity: 0;
      transition: opacity 0.8s ease-in-out;
    }

    .image-container img.active {
      opacity: 1;
    }

    /* Rest of the previous styles */
    .step {
      margin: 0 auto 80vh auto;
      padding: 2rem;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      opacity: 0.2;
      transition: all 0.5s ease;
    }

    .step.is-active {
      opacity: 1;
      transform: translateX(0);
      background-color: white;
    }

    .step p {
      font-size: 1.2rem;
      line-height: 1.8;
      margin: 0;
    }

    .progress-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 0;
      height: 4px;
      background: #3498db;
      z-index: 1000;
      transition: width 0.1s ease;
    }

    .footer {
      text-align: center;
      padding: 4rem 2rem;
      background: #2c3e50;
      color: white;
    }

    .footer a {
      color: #3498db;
      text-decoration: none;
    }

    .footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 768px) {
      .step {
        margin-bottom: 60vh;
      }
      
      h1 {
        font-size: 2.5em;
      }
      
      .subtitle {
        font-size: 1.2em;
      }
    }
  </style>
</head>

<body>
  <div class="progress-bar"></div>
  
  <section class="intro">
    <h1>Concrete Dreams</h1>
    <p class="subtitle">Where Italian kids turned parking lots into soccer stadiums</p>
  </section>

  <main>
    <section id="scrolly">
      <article>
        <div class="step" data-step="1">
          <p>My childhood neighborhood in northern Italy was an unremarkable residential area, dotted with terracotta-roofed houses and narrow streets. As seen from above, it was a typical Italian suburb: orderly rows of homes, small gardens, and — within walking distance — both a playground and a proper soccer field. Everything a kid could want, neatly arranged in a small corner of the world.</p>
        </div>

        <div class="step" data-step="2">
          <p>My childhood revolved around two best friends: Alex (who held the coveted status of 'favorite' thanks to his family's swimming pool) and Simone.
          Our houses formed a triangle, with the parking lot at its center—our daily stage for adventure. To the north it was bordered by Napoleon-era walls, and as a child, I'd proudly tell visitors that Napoleon himself had built them (he did not). </p>
        </div>
        
        <div class="step" data-step="3">
          <p>This was our real world - a simple parking lot between our houses. Between the parked cars and concrete surface, it wasn't much to look at. Two sewer covers marked our goal posts, and the uneven surface added an element of unpredictability to every game. But to us, it was perfect.</p>
        </div>
        
        <div class="step" data-step="4">
          <p>While a regulation field could contain our makeshift pitch about forty times over, we created our own soccer field right here in the parking lot. We mapped out our field between the cars, using whatever space was available. Our imagination filled in what the concrete lacked.</p>
        </div>
        
        <div class="step" data-step="5">
          <p>This wasn't just any parking lot - it was our arena. The space between parked cars became shooting lanes, and every game was a World Cup final in our minds, even if our stadium was just a few square meters of concrete.</p>
        </div>

        <div class="step" data-step="6">
          <p>Looking at it now, maybe the reason was obvious: location, location, location. The parking lot sat at the perfect intersection of our lives - my house on one side, Alex's (with his coveted swimming pool) below, and Simone's on the other side. It was our natural meeting point, our everyday stadium.</p>
        </div>

        <div class="step" data-step="7">
          <p>Above us, an ancient stone wall from the Napoleonic era watched over our games like a silent guardian. I used to tell visitors, with a child's misunderstanding of history, that Napoleon himself had built that wall. Between that historical backdrop and the fruit trees that provided our post-game snacks, our humble parking lot was more than just a place to play - it was our own piece of paradise.</p>
        </div>
      </article>

      <div class="sticky-thing">
        <div class="image-container">
          <!-- We'll populate these images via JavaScript -->
        </div>
      </div>
    </section>
  </main>

  <div class="footer">
    <p>Story by Marco Dalla Stella | Inspired by <a href="https://atd124.github.io/stickball/">How can you not be romantic about stickball?</a> by Anthony D'Arrigo</p>
  </div>

  <script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>
  <script src="https://unpkg.com/scrollama"></script>
  <script>
    // Initialize scrollama
    const scroller = scrollama();
    
    // DOM elements
    const main = document.querySelector("main");
    const scrolly = main.querySelector("#scrolly");
    const sticky = scrolly.querySelector(".sticky-thing");
    const imageContainer = sticky.querySelector(".image-container");
    const article = scrolly.querySelector("article");
    const steps = article.querySelectorAll(".step");
    const progressBar = document.querySelector(".progress-bar");

    // Preload images
    function preloadImages() {
      // Create all image elements at start
      for (let i = 1; i <= steps.length; i++) {
        const img = document.createElement('img');
        img.src = `images/${i}_field.png`;
        img.alt = `Field visualization ${i}`;
        img.className = i === 1 ? 'active' : ''; // Make first image active
        imageContainer.appendChild(img);
      }
    }

    // Generic window resize listener
    function handleResize() {
      scroller.resize();
    }

    // Scrollama event handlers
    function handleStepEnter(response) {
      const el = response.element;
      const stepIndex = el.dataset.step;
      
      // Update progress bar
      const progress = (stepIndex / steps.length) * 100;
      progressBar.style.width = `${progress}%`;

      // Update image visibility
      const images = imageContainer.querySelectorAll('img');
      images.forEach(img => img.classList.remove('active'));
      images[stepIndex - 1].classList.add('active');

      // Update active step
      steps.forEach(step => step.classList.remove('is-active'));
      el.classList.add('is-active');
    }

    function init() {
      // Preload images
      preloadImages();

      // Set up Scrollama
      scroller
        .setup({
          step: "#scrolly article .step",
          offset: 0.5,
          debug: false
        })
        .onStepEnter(handleStepEnter);

      // Setup resize event
      window.addEventListener("resize", handleResize);
    }

    // Start everything
    init();

    // Add smooth scroll progress bar
    window.addEventListener('scroll', () => {
      const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrolled = (winScroll / height) * 100;
      progressBar.style.width = scrolled + "%";
    });
  </script>
</body>
</html>